class Moostaka{constructor(opts){this.routes=[];this.defaultRoute="/";this.viewLocation="/views";if(location.pathname===""){history.pushState("data",this.defaultRoute,this.defaultRoute)}if(opts){this.defaultRoute=typeof opts.defaultRoute!=="undefined"?opts.defaultRoute:this.defaultRoute;this.viewLocation=typeof opts.viewLocation!=="undefined"?opts.viewLocation:this.viewLocation}let self=this;document.addEventListener("click",event=>{if(event.target.matches("a[href], a[href] *")){let element=event.target;while(element instanceof HTMLElement){if(element.href){if(element.href.startsWith(location.host)||element.href.startsWith(location.protocol+"//"+location.host)){event.preventDefault();let url=element.href.replace("http://","").replace("https://","").replace(location.host,"");let text=document.title;if(element.title instanceof String&&element.title!=""){text=element.title}else if(event.target.title instanceof String&&event.target.title!=""){text=event.target.title}history.pushState({},text,element.href);self.navigate(url)}return}else{element=element.parentElement}}}},false);window.onpopstate=(e=>{self.navigate(location.pathname)})}navigate(pathname){if(this.onnavigate){this.onnavigate(pathname)}if(!pathname||pathname==="/"){pathname=this.defaultRoute}let hashParts=pathname.split("/");let params={};for(let i=0,len=this.routes.length;i<len;i++){if(typeof this.routes[i].pattern==="string"){let routeParts=this.routes[i].pattern.split("/");let thisRouteMatch=true;if(routeParts.length!==hashParts.length){thisRouteMatch=false}else{for(let x=0;x<routeParts.length;x++){if(routeParts[x]==="*"){break}if(routeParts[x].substring(0,1)!==":"){if(lowerCase(routeParts[x])!==lowerCase(hashParts[x])){thisRouteMatch=false}}else{if(thisRouteMatch){let partName=routeParts[x].substring(1);params[partName]=hashParts[x]}}}}if(thisRouteMatch===true){return this.routes[i].handler(params)}}else{if(pathname.substring(1).match(this.routes[i].pattern)){return this.routes[i].handler({hash:pathname.substring(1).split("/")})}}}if(this.defaultRoute!=pathname){history.pushState("data","home",this.defaultRoute);this.navigate(this.defaultRoute)}}render(element,view,params,options,callback){let destination=null;if(element instanceof HTMLElement){destination=element}else{destination=document.querySelector(element)}if(!params){params={}}if(!options){options={}}if(typeof options.tags==="undefined"){Mustache.tags=["{{","}}"]}else{Mustache.tags=options.tags}if(typeof options.append==="undefined"){options.append=false}let url=this.viewLocation+"/"+view.replace(".mst","")+".mst";fetch(url).then(response=>{return response.text()}).then(template=>{if(options.append===true){destination.innerHTML+=Mustache.render(template,params)}else{while(destination.firstChild){destination.removeChild(destination.firstChild)}destination.innerHTML=Mustache.render(template,params)}if(callback instanceof Function){callback()}})}getHtml(view,params,options,callback){if(!(callback instanceof Function)){throw new TypeError("callback is not a function")}if(!params){params={}}if(!options){options={}}if(typeof options.tags==="undefined"){Mustache.tags=["{{","}}"]}else{Mustache.tags=options.tags}if(typeof options.markdown==="undefined"){options.markdown=false}let url=this.viewLocation+"/"+view.replace(".mst","")+".mst";fetch(url).then(response=>{return response.text()}).then(template=>{if(window.markdownit&&options.markdown===true){let md=window.markdownit();callback(Mustache.render(md.render(template),params))}else{callback(Mustache.render(template,params))}})}route(pattern,handler){this.routes.push({pattern:pattern,handler:handler})}flush(){this.routes=[]}}function lowerCase(value){if(value){return value.toLowerCase()}return value}